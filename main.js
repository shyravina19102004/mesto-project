(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"4c5d7056-3240-496c-870a-4171feb0525e","Content-Type":"application/json"}},t=document.querySelector("#card-template").content.querySelector(".places__item"),n=document.querySelector(".places__list"),o=document.querySelector(".popup_type_edit"),r=document.querySelector(".popup_type_new-card"),c=document.querySelector(".popup_type_image"),a=document.querySelector(".profile__title"),u=document.querySelector(".profile__description"),i=document.querySelector(".profile__image"),s=c.querySelector(".popup__image"),l=c.querySelector(".popup__caption");function d(n){var o=t.cloneNode(!0),r=o.querySelector(".card__title"),a=o.querySelector(".card__image"),u=o.querySelector(".card__like-count");a.src=n.link,a.alt=n.name,r.textContent=n.name,u.textContent=n.likes.length,o.querySelector(".card__delete-button").addEventListener("click",(function(){var t;(t=n._id,fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){o.remove()})).catch((function(e){console.error("Ошибка при удалении карточки:",e)}))}));var i=o.querySelector(".card__like-button");return i.addEventListener("click",(function(){var t;i.classList.contains("card__like-button_is-active")?(t=n._id,fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){i.classList.remove("card__like-button_is-active"),u.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при снятии лайка:",e)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n._id).then((function(e){i.classList.add("card__like-button_is-active"),u.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при постановке лайка:",e)}))})),a.addEventListener("click",(function(){var e,t;e=n.name,t=n.link,s.src=t,s.alt=e,l.textContent=e,p(c)})),o}function p(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",f)}function _(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",f)}function f(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&_(t)}}document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(e){_(e.target.closest(".popup"))}))})),document.addEventListener("click",(function(e){e.target.classList.contains("popup")&&_(e.target)})),document.addEventListener("DOMContentLoaded",(function(){fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){a.textContent=e.name,u.textContent=e.about,i.style.backgroundImage="url(".concat(e.avatar,")")})).catch((function(e){console.error("Ошибка при загрузке информации о пользователе:",e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){!function(e){e.forEach((function(e){var t=d(e);n.appendChild(t)}))}(e)})).catch((function(e){console.error("Ошибка при загрузке карточек:",e)}))})),document.querySelector(".profile__edit-button").addEventListener("click",(function(){var e=o.querySelector(".popup__input_type_name"),t=o.querySelector(".popup__input_type_description");e.value=a.textContent,t.value=u.textContent,p(o)}));var m=o.querySelector(".popup__form"),h=m.querySelector(".popup__button");m.addEventListener("submit",(function(t){var n,r;t.preventDefault(),h.textContent="Сохранение...",(n=t.target.elements.name.value,r=t.target.elements.description.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){a.textContent=e.name,u.textContent=e.about,_(o)})).catch((function(e){console.error("Ошибка при обновлении информации о пользователе:",e)})).finally((function(){h.textContent="Сохранить"}))})),document.querySelector(".profile__add-button").addEventListener("click",(function(){var e=r.querySelector(".popup__input_type_card-name"),t=r.querySelector(".popup__input_type_url");e.value="",t.value="",p(r)})),r.querySelector(".popup__form").addEventListener("submit",(function(t){var o,c;t.preventDefault(),h.textContent="Сохранение...",(o=t.target.elements["place-name"].value,c=t.target.elements.link.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o,link:c})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){var t=d(e);n.prepend(t),_(r)})).catch((function(e){console.error("Ошибка при добавлении карточки:",e)})).finally((function(){h.textContent="Сохранить"}))}));var v=document.querySelector(".profile__image-edit-button"),y=document.querySelector(".popup_type_avatar"),S=y.querySelector(".popup__form"),k=S.querySelector(".popup__input"),q=S.querySelector(".popup__button");v.addEventListener("click",(function(){k.value="",p(y)})),S.addEventListener("submit",(function(t){var n;t.preventDefault(),q.textContent="Сохранение...",(n=k.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){i.style.backgroundImage="url(".concat(e.avatar,")"),_(y)})).catch((function(e){console.error("Ошибка при обновлении аватара:",e)})).finally((function(){q.textContent="Сохранить"}))}))})();