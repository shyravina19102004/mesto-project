(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/frontend-st-cohort-201",headers:{authorization:"527e56c5-bdc5-4bdd-801d-0c692eba7df1","Content-Type":"application/json"}},t=document.querySelector(".popup_type_edit-profile"),n=document.querySelector(".profile__edit"),o=t.querySelector(".popup__close"),r=t.querySelector(".popup__form"),c=document.querySelector(".profile__avatar").querySelector(".avatar"),u=document.querySelector(".popup_type_add-element"),a=document.querySelector(".profile__add-button"),i=u.querySelector(".popup__close"),s=u.querySelector(".popup__form"),l=document.querySelector(".popup_type_image"),d=l.querySelector(".popup__close"),p=document.querySelector(".popup_type_edit-avatar"),f=p.querySelector(".popup__form"),_=p.querySelector(".popup__close"),m=document.querySelector(".avatar__edit"),v={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},y=document.querySelector("#card-template"),h=document.querySelector(".popup__image_type_text"),S=document.querySelector(".popup__image_type_photo"),q=document.querySelector(".elements__list"),k=document.forms.addCard,b=k.querySelector(".popup__button-save"),E=u.querySelector(".popup__input_type_title"),L=u.querySelector(".popup__input_type_link"),g=document.forms.editProfile,C=g.querySelector(".popup__button-save"),j=t.querySelector(".popup__input_type_name"),x=t.querySelector(".popup__input_type_job"),A=document.forms.editAvatar,P=A.querySelector(".popup__button-save"),U=document.querySelector(".avatar"),w=document.querySelector(".profile__vocation"),T=document.querySelector(".profile__name");function D(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");null!==t&&I(t)}}function B(e){e.classList.add("popup_opened"),document.addEventListener("keydown",D)}function I(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",D)}function N(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function O(t){var n=function(t){var n=t.name,o=t.link,r=t.counter,c=t.showUrn,u=t.cardId,a=t.showLike,i=y.content.querySelector(".element").cloneNode(!0),s=i.querySelector(".element__image"),d=i.querySelector(".element__counter"),p=i.querySelector(".element__urn"),f=i.querySelector(".element__heart"),_=i.querySelector(".element__text"),m=a;return c&&p.classList.add("element__urn_active"),m&&f.classList.add("element__heart_active"),s.src=o,s.alt=n,_.textContent=n,d.textContent=r,p.addEventListener("click",(function(){(function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))})(u).then((function(){i.remove()})).catch((function(e){console.log(e)}))})),f.addEventListener("click",(function(t){m?function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))}(u).then((function(e){d.textContent=e.likes.length,t.target.classList.toggle("element__heart_active"),m=!1})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))}(u).then((function(e){d.textContent=e.likes.length,t.target.classList.toggle("element__heart_active"),m=!0}))})),s.addEventListener("click",(function(){h.textContent=n,S.src=o,S.alt=n,B(l)})),i}(t);q.prepend(n)}var J=function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)},H=function(e){return!e.dataset.reg||!new RegExp(e.dataset.reg).test(e.value)},z=function(e,t,n){H(t)?t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""}(e,t,n):J(e,t,t.validationMessage,n):J(e,t,t.dataset.status,n)},M=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);!function(e){return e.some((function(e){return!H(e)||!e.validity.valid}))}(n)?(o.disabled=!1,o.classList.remove(t.inactiveButtonClass)):(o.disabled=!0,o.classList.add(t.inactiveButtonClass))};s.addEventListener("submit",(function(t){var n,o;t.preventDefault(),N(!0,b),(n=k.elements.name.value,o=k.elements.link.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))).then((function(e){O({name:E.value,link:L.value,counter:0,showUrn:!0,cardId:e._id}),I(u),k.reset()})).catch((function(e){console.log(e)})).finally((function(){N(!1,b)}))})),r.addEventListener("submit",(function(n){return n.preventDefault(),N(!0,C),(o=g.elements.name.value,r=g.elements.about.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))).then((function(e){w.textContent=e.about,T.textContent=e.name,I(t),g.reset()})).catch((function(e){console.log(e)})).finally((function(){N(!1,C)}));var o,r})),f.addEventListener("submit",(function(t){return t.preventDefault(),N(!0,P),function(t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))}))}(A.elements.linkImage.value).then((function(e){U.src=e.avatar,I(p),A.reset()})).catch((function(e){console.log(e)})).finally((function(){N(!1,P)}))})),d.addEventListener("click",(function(){I(l)})),n.addEventListener("click",(function(){j.value=T.textContent,x.value=w.textContent,function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(n){z(e,n,t)}))}(r,v),M(r,v),B(t)})),o.addEventListener("click",(function(){I(t)})),a.addEventListener("click",(function(){M(s,v),B(u)})),i.addEventListener("click",(function(){I(u)})),m.addEventListener("click",(function(){M(f,v),B(p)})),_.addEventListener("click",(function(){I(p)}));var R;fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(e){return T.textContent=e.name,w.textContent=e.about,c.src=e.avatar,e})).then((function(t){return n=t._id,fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Что-то пошло не так: ".concat(e.status))})).then((function(e){!function(e,t){e.forEach((function(e){var n=e.likes.length,o=e.owner._id===t,r=e.likes.some((function(e){return e._id===t}));O({name:e.name,link:e.link,counter:n,showUrn:o,cardId:e._id,showLike:r})}))}(e,n)})).catch((function(e){console.log("Ошибка. Запрос не выполнен")}));var n})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(n){n.preventDefault(),M(t,e)})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));M(e,t),n.forEach((function(n){n.addEventListener("input",(function(){z(e,n,t),M(e,t)}))}))}(t,e)}))}(v),R=document.querySelectorAll(".popup"),Array.from(R).forEach((function(e){e.addEventListener("mousedown",(function(t){t.target===e&&I(e)}))}))})();